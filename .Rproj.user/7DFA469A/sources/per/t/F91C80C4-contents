
---
title: "Spilloverfile"
author: "Jonathan Wilson"
date: "14/01/2020"
output: html_document
---

```{r}
library(tidyverse)
library(here)
library(readr)
library(visdat)
library(tibble)

```
```{r}

Spillover_Mainsheet <- read_csv(here("data","raw_data","Virus_Spillover_p1.csv"))
Spillover_Mainsheet <- Spillover_Mainsheet[c(1:89),c(1:30)]
vis_miss(Spillover_Mainsheet)
glimpse(Spillover_Mainsheet)
unique(Spillover_Mainsheet$Cell_Tropism)
unique(Spillover_Mainsheet$Cell_Receptor)
```
```{r}
#now i shall reename the columns to have nioce names with no spaces because r likes it that way
colnames(Spillover_Mainsheet)[13]<-"Genetic_Material" 
colnames(Spillover_Mainsheet)[14]<-"Stranded"
colnames(Spillover_Mainsheet)[6]<-"Cross_species_spillover"
colnames(Spillover_Mainsheet)[16]<-"Enveloped"
colnames(Spillover_Mainsheet)[29]<-"Organs_effected"
colnames(Spillover_Mainsheet)[30]<-"Incubation_period"
```

```{r}
#Now i shall recode any "unknowns", "-" etc. as NA using nanaiar
library(naniar)
Spillover_Mainsheet <- Spillover_Mainsheet %>%  replace_with_na(replace =  list(Cell_Receptor = "unknown", Cell_Tropism = "unknown", Entry_Mechanism = "unknown", Receptor_Distribution="unknown", Host=c("unknown", "Unknown"), Transmission_Mechanism="unknown", Shedding_Period = c("-", "unknown"), Shedding_Length =c("-", "unknown"), Mortality_Rate =c("-", "unknown"), Cross_species_spillover = "unknown", Transmission_Route = "unknown", Shedding_Route="unknown", Host_Range= c("unknown", "Unknown"),  Replication_Site = "unknown", Within_Host_Spread= "unknown",  Organs_effected= "unknown", Incubation_period=c("unknown", "-")))

#now i shall recode y/n time data as factors in this case True or False
Spillover_Mainsheet1<- Spillover_Mainsheet %>% mutate(Zoonotic = recode(Zoonotic, "n" = F, "y" = T)) %>% mutate(Cross_species_spillover=recode(Cross_species_spillover, "n"=F, "y"=T))  %>% mutate(Vector=recode(Vector, "n"=F, "y"=T))  %>% mutate(Segmented=recode(Segmented, "n"=F, "y"=T))  %>% mutate(Viraemia=recode(Viraemia, "n"=F, "y"=T))%>% mutate(Enveloped=recode(Enveloped, "enveloped"=T))
```
```{r}
#Now i shall mutate a new variable to group our host ramnges into categories whilst still retaining the more specfic info

Spillover_Mainsheet2<- Spillover_Mainsheet1%>% dplyr::mutate(Host_Width_new = Host_Range)



Spillover_Mainsheet2$Host_Width_new[Spillover_Mainsheet2$Host_Width_new=="Narrow (bats)"] <- "Narrow (Bats)"

#now we'll recode this varibale as broaadd, naroow or restricted

swn<-Spillover_Mainsheet2[grep("Narrow", Spillover_Mainsheet2$Host_Width_new), ]
swn$Host_Width_new<-swn$Host_Width_new<-"Narrow"

swb<-Spillover_Mainsheet2[grep("Broad", Spillover_Mainsheet2$Host_Width_new),]
swb$Host_Width_new<-swb$Host_Width_new<-"Broad"

swr<-Spillover_Mainsheet2[grep("Restricted", Spillover_Mainsheet2$Host_Width_new),]
swr$Host_Width_new<-swr$Host_Width_new<-"Restricted"

swa<-Spillover_Mainsheet2 %>% subset(is.na(Spillover_Mainsheet2$Host_Width_new))

Spillover_Mainsheet3<- bind_rows(swn, swb, swr, swa)


Spillover_Mainsheet4 <- Spillover_Mainsheet3 %>% mutate(Transmission_Mechanism=recode(Transmission_Mechanism, "Direct/indirect contact"= "Both", "Aerosol infection and direct contact"= "Both"))

```

```{r}
Spillover_Mainsheet5<- Spillover_Mainsheet4%>% dplyr::mutate(Rep_site_factor = Replication_Site)


Spillover_Mainsheet5 <- Spillover_Mainsheet5 %>% mutate(Rep_site_factor=recode(Rep_site_factor, "Respiratory tract epithelium" = "Respiratory_Epithelium", "Upper and lower respiratory tract epithelium" = "Respiratory_Epithelium", "Lungs (bronquiolar epithelial cells)" = "Respiratory_Epithelium", "Lungs (bronchial epithelial cells)" = "Respiratory_Epithelium"  ,"Upper and lower respiratory tract epithelium"="Respiratory_Epithelium",  "Respiratory ciliated epithelium"="Respiratory_Epithelium", "Respiratory tract"  = "Respiratory_Epithelium" , "Nasopharyngeal epithelium"  = "Respiratory_Epithelium",  "Spinal cord and brain (nervous tissues)"= "Neural_Tissue",  "Peripheral, central and autonomic nervous systems (astrocytes, Schwann cells, ependymal cells)" = "Neural_Tissue"  ))


```